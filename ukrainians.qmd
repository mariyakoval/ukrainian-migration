---
title: "ukrainians"
format: html
editor: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
# set code chunk option defaults
knitr::opts_chunk$set(
  # display code as types
  tidy = FALSE, 
  # slightly smaller code font
  size = "small",
  # do not display messages in PDF
  message = FALSE,
  # set default figure width and height
  fig.width = 5, fig.height = 3) 
```

```{r, include=FALSE}

# Load necessary packages
if (!require('pacman')) install.packages('pacman'); library('pacman')
pacman::p_load(viridis, tidyverse, ggplot2, lubridate, knitr, dplyr, ggpubr, 
              janitor, tidyr, kableExtra, ggcorrplot, ggthemes, zoo, forcats,
              gridExtra, grid, Hmisc, FSA, dunn.test, readxl, RColorBrewer,
              patchwork)
# Load data
data_ee <- readRDS("Data/data_ee")
combined_df <- readRDS("Data/combined_df")
combined_eu <- readRDS("Data/combined_eu")
reasons_country_ee <- readRDS("Data/reasons_country_ee")
data_eu <- read_csv("Data/data_eu")
```

**Introduction**

Potential research questions: - Which factors are associated with
economic self-sufficiency? (affording more goods) - What influences the
decision to return (temporarily or permanently) to Ukraine? - Does
perceived hostility or social cohesion affect intent to stay?

The geographical scope of the analysis includes countries in Central and Eastern Europe, such as Estonia, Poland, Czechia, Slovakia, Romania, Moldova. While some data is available for all countries, other variables are available only for a subset of countries. The main goals of the study include describing the socio-economic profiles of Ukrainian refugees in these countries; compare the quality of accommodation, services, and support; identify factors associated with economic self-sufficiency and the decision to return to Ukraine; examine the impact of social cohesion or perceived hostility on refugees’ intent to stay or move.

**Data and methods**

**Ukrainian Refugees in Estonia EDA**

**Demographics**

The bar chart displays the distribution of survey respondents by age group (18–34, 35–59, 60+) across six Central and Eastern European countries. Across all countries, the 35–59 age group consistently has the highest number of respondents, followed by the 18–34 group, with the 60+ group being the least represented. Romania stands out with a particularly high
concentration of respondents in the 35–59 group compared to the other age categories. Estonia shows a more balanced distribution between the younger and middle-aged groups, though the same pattern persists. In contrast, the data for Poland appears to be missing or not displayed in the chart.

```{r, fig.width=6, fig.height=4, warning=FALSE}
# Function to create a clean proportion table
make_prop_table <- function(variable) {
  tibble(
    Category = names(table(variable, useNA = "ifany")),
    Count = as.numeric(table(variable, useNA = "ifany")),
    Percent = round(100 * (prop.table(table(variable, useNA = "ifany"))), 2)
  )
}

gg <- theme_minimal() +
  theme(
    legend.position = "none",
    plot.title = element_text(size = 10, face = "bold"),
    axis.title = element_text(size = 8),
    axis.text = element_text(size = 7)
  )

data_eu |>
  filter(!country %in% c("Hungary", "Bulgaria")) |>
  bind_rows(data_ee |> 
              rename(DR7_3_NUM_RESP_AGE = introduction_resp_age) |> 
              mutate(country = "Estonia")) |>
  filter(!is.na(DR7_3_NUM_RESP_AGE), !is.na(country)) |>
  mutate(DR7_3_NUM_RESP_AGE = factor(DR7_3_NUM_RESP_AGE, 
                                     levels = c("18-34", "35-59", "60+"))) |>
  count(country, DR7_3_NUM_RESP_AGE) |>
  group_by(country) |>
  mutate(Percent = n / sum(n) * 100) |>
  ggplot(aes(x = country, y = Percent, fill = DR7_3_NUM_RESP_AGE)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(x = "Country",
       y = "Percent of Respondents",
       fill = "Age Group",
       title = "Age Distribution of Respondents by Country") +
  theme_minimal() +
  theme(legend.position = "top",
        axis.text.y = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  guides(fill = guide_legend(title.position = "top", title.hjust = 0.5)) +
  scale_fill_brewer(palette = "Paired")

```

While the data on education of Ukrainian refugees is limited, the snapshot of age distribution reveals that the majority of arrivals are part of labor force. Notably, 49.46% of arrivals hold a vocational and specialization education, followed by
around 38% of refugees with Master or Bachelor degrees. People with secondary education are moderately represented, but there are very few people with PhD education. The largest group is employed, indicating that many refugees were active in the workforce before displacement. Other categories include students, self-employed, and those in housekeeping.

```{r, fig.width=7, fig.height=2, warning=FALSE}

e4 <- ggplot(data_ee, aes(x = fct_infreq(demographics_educ_level), 
                          fill = demographics_educ_level  )) +
  geom_bar(stat = "count") + gg + xlab("Education") + ylab("Count") +
  scale_fill_brewer(palette = "Paired")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

e5 <- ggplot(data_ee, aes(x = fct_infreq(demographics_resp_activity), 
                          fill = demographics_resp_activity)) +
  geom_bar(stat = "count") + gg + 
  xlab("Activity status") + ylab("Count") +
  scale_fill_brewer(palette = "Paired")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Arrange all plots
grid.arrange(grobs = list(e4, e5),
             ncol = 2, nrow = 1,
             top = "Bar Plots of Key Demographic Variables in Estonia Dataset")
```

It is needed to understand why refugees choose to resettle in specific states in order to evaluate integration policy and strategy responses. Demographic trends provide a general regional overview, but Estonia offers more detailed information on legal and individual determinants influencing refugees' decisions.

In Estonia, 55.76% of the interviewees said they had been subjected to family separation, and reunifying with family was among the most frequently cited reasons for choosing the destination. Language, geographic closeness, labor market opportunities, and cultural familiarity were also major determinants. All of these suggest that emotional, utilitarian, and socio-economic drivers all play a role in shaping refugee choice in destination countries.

```{r}

# Choose top-5 reasons for choosing Estonia
top6 <- reasons_country_ee |>
  dplyr::arrange(desc(Total_Proportion)) |>
  dplyr::slice_head(n = 5)|>
  mutate(Percent = round(Total_Proportion * 100, 2))

ggplot(top6, aes(x = reorder(Component, -Percent), 
                 y = Percent, fill = Percent)) +
  geom_bar(stat = "identity") + gg +
  coord_flip() +
  xlab("What motivated you to come to this country?") + ylab("Count") +
  scale_fill_gradient(low = "lightblue", high = "darkblue") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

**Economic capacity and Aid**

The faceted bar chart indicates the sources of declared income. The most apparent trend is the dominant role of "employment in the host country" as the principal source of income in most countries, especially in Czechia, Estonia, and Slovakia, where it accounts for over 40–50%. Moldova is the exception: "social protection in Ukraine" is the most frequently reported source, and may reflect that there are many refugees there who employ assistance from the home country. Romania has a more balanced split, with employment percentages, other sources, and maintained employment from Ukraine all being similar, however, it also has the highest number of people with no income. Remote work and remittances in Romania and Poland respectively also arise more than anywhere else. Across all countries, rates like "do not know", "prefer not to answer", and "no income" are low. This band shows levels of integration, access to work, and host country versus origin country welfare system reliance.

```{r, fig.height = 7, fig.width=8}
df_all <- bind_rows(
  combined_eu |>
    filter(Source == "income", !Country %in% c("Hungary", "Bulgaria")) |>
    mutate(Percent = round(Total_Proportion * 100, 2)) |>
    select(Component, Percent, Country),
  
  combined_df |>
    filter(Source == "income_sources") |>
    mutate(Percent = round(Total_Proportion * 100, 2),
           Country = "Estonia") |>
    select(Component, Percent, Country)) |>
  group_by(Country) |>
  arrange(desc(Percent), .by_group = TRUE) |>
  slice_head(n = 5) |>
  ungroup()

df_all$Component <- factor(df_all$Component, levels = unique(df_all$Component))

ggplot(df_all, aes(x = reorder(Component, -Percent), y = Percent, fill = Component)) +
  geom_col(show.legend = TRUE) +
  facet_wrap(~Country, scales = "free_x") +
  xlab("Income Source") + ylab("Percent") +
  theme_minimal() +
  theme(legend.position = "right",
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  ggtitle("Comparison of Reported Income Sources by Country") +
  guides(fill = guide_legend(title.position = "top", title.hjust = 0.5))

```


31% of refugees didn't encounter any issues while looking for a job. The main concern, however, was the lack of language as 36% of people faced it. the second biggest obstacle was the lack of opportunities and lack of recognition, as noted by 11% and 7% of people respectively.


```{r}

make_prop_table(data_ee$host_country_work_coa)

combined_df |>
  filter(Source == "work") |>
  mutate(Percent = round(Total_Proportion * 100, 2)) |>
  select(Component, Percent) |>
  arrange(desc(Percent))
```

```{r}

make_prop_table(data_ee$economic_capicity_L13_SS_AFF_GOODS)
make_prop_table(data_ee$economic_capicity_L13_1_SM_MORE_GOODS)
make_prop_table(data_ee$economic_capicity_L13_1_SM_LESS_GOODS)
```

Urgent needs first: employment, accommodation, education for adults.
Second - medical, material, psychological.

```{r}

make_prop_table(data_ee$aap_AAP_0_SS_SATISFIED_AID)
make_prop_table(data_ee$urgent_needs_urgent_needs_first)
make_prop_table(data_ee$urgent_needs_urgent_needs_second)
```

**Safety**

According to data, 35.61% of refugees in Estonia experiences hostile
attitude, that included aggressive comments in news forums online' or
social media, verbal aggression, or physical aggression. In particular,
verbal aggression was one of the main concerns, as 14.6% of people
reported this from of hostile behavior, followed by aggressive comments
on social media and discriminatory behavior accounting for 7% and 6% of
responses respectively.

```{r}

make_prop_table(data_ee$social_cohesion_SC3_SS_EXP_HOSTILE)

combined_df |>
  filter(Source == "cohesion") |>
  mutate(Percent = round(Total_Proportion * 100, 2)) |>
  select(Component, Percent) |>
  arrange(desc(Percent))
```

**Traveling back**

Reasons of going permanently to Ukraine

Reasons for traveling back temporarily: visit relatives, check property,
get documents. 77.16% expect to stay in Estonia.

```{r}
make_prop_table(data_ee$Travel_Ukraine_temp_return )

combined_df |>
  filter(Source == "return") |>
  mutate(Percent = round(Total_Proportion * 100, 2)) |>
  select(Component, Percent) |>
  arrange(desc(Percent))

make_prop_table(data_ee$Travel_Ukraine_no_return_plans )
make_prop_table(data_ee$Travel_Ukraine_return_length)
make_prop_table(data_ee$Travel_Ukraine_no_return_move_country )
make_prop_table(data_ee$Travel_Ukraine_no_return_move_reasons )

```

**Tests**

```{r}
table1 <- table(data_ee$Travel_Ukraine_no_return_plans, data_ee$economic_capicity_L13_SS_AFF_GOODS)
chisq.test(table1)
fisher.test(table1)

```

**Discussion**

**Conclusion**
