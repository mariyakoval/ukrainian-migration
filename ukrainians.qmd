---
title: "ukrainians"
format: html
---

```{r setup, include=FALSE}
# set code chunk option defaults
knitr::opts_chunk$set(
  # display code as types
  tidy = FALSE, 
  # slightly smaller code font
  size = "small",
  # do not display messages in PDF
  message = FALSE,
  # set default figure width and height
  fig.width = 5, fig.height = 3) 
```

```{r, include=FALSE}

# Load necessary packages
if (!require('pacman')) install.packages('pacman'); library('pacman')
pacman::p_load(viridis, tidyverse, ggplot2, lubridate, knitr, dplyr, ggpubr, 
              janitor, tidyr, kableExtra, ggcorrplot, ggthemes, zoo, forcats,
              gridExtra, grid, Hmisc, FSA, dunn.test, readxl, RColorBrewer)
# Load data
data_ee <- readRDS("Data/data_ee")
work_df <- readRDS("Data/work_df")
income_sources_df <- readRDS("Data/income_sources_df")
med_issues_df <- readRDS("Data/med_issues_df")
reasons_country_ee <- readRDS("Data/reasons_country_ee")
housing_issues_df <- readRDS("Data/housing_issues_df")
```

**Introduction**

Potential research questions: 
- Which factors are associated with economic self-sufficiency? (affording more goods)
- What influences the decision to return (temporarily or permanently) to Ukraine?
- Does perceived hostility or social cohesion affect intent to stay?

**Data and methods**

*Ukrainian Refugees in Estonia*
*EDA*

**Demographics**

Key demographcic indicators of Ukrainian refugees in Estonia reveal that the majority of refugees are between 35 and 59 years old, closely followed by the 18-34 age group. Refugees aged 60 and older represent a minority of arrivals, indicating a younger to middle-aged demographic predominance. The largest wave of arrivals to Estonia occurred between March and April of 2022, with 45.68% of all arrivals within the period falling in this range. There are mild arrival peaks in May and July of 2022. 49.46% of arrivals hold a vocational and specialization education, followed by around 38% of refugees with Master or Bachelor degrees. People with secondary education are moderately represented, but there are very few people with PhD education. The largest group is employed, indicating that many refugees were active in the workforce before displacement. Other categories include students, self-employed, and those in housekeeping. 

```{r, fig.width=6, fig.height=4, warning=FALSE}
# Common theme for plots
gg <- theme_minimal() +
  theme(
    legend.position = "none",
    plot.title = element_text(size = 10, face = "bold"),
    axis.title = element_text(size = 8),
    axis.text = element_text(size = 7)
  )

# EDA plots
e1 <- ggplot(data_ee, aes(x = introduction_resp_age, 
                          fill = introduction_resp_age)) +
  geom_bar(stat = "count") + gg + xlab("Age") + ylab("Count") +
  scale_fill_brewer(palette = "Paired")

e3 <- ggplot(data_ee, aes(x = introduction_date_arrival, 
                          fill = as.factor(introduction_date_arrival ))) +
  geom_bar(stat = "count") +
  scale_fill_brewer(palette = "Paired") +
  xlab("Date of arrival") +
  ylab("Count")+
  xlim(as.Date("2022-01-01"), as.Date("2023-01-01")) +gg +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

e4 <- ggplot(data_ee, aes(x = fct_infreq(demographics_educ_level), 
                          fill = demographics_educ_level  )) +
  geom_bar(stat = "count") + gg + xlab("Education") + ylab("Count") +
  scale_fill_brewer(palette = "Paired")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

e5 <- ggplot(data_ee, aes(x = fct_infreq(demographics_resp_activity), 
                          fill = demographics_resp_activity)) +
  geom_bar(stat = "count") + gg + 
  xlab("Activity status") + ylab("Count") +
  scale_fill_brewer(palette = "Paired")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Arrange all plots
grid.arrange(grobs = list(e1, e3, e4, e5),
             ncol = 2, nrow = 2,
             top = "Bar Plots of Key Demographic Variables in Estonia Dataset")
```

**Legal status and choice of country**

While 55.76% of respondents experienced family separation, reunification with relatives was among the primary motivations for coming to Estonia. The remaining important reasons for choosing Estonia are language, its proximity, work opportunities, and cultural reasons.

```{r}

# Choose top-5 reasons for choosing Estonia
top6 <- reasons_country_ee |>
  dplyr::arrange(desc(Total_Proportion)) |>
  dplyr::slice_head(n = 5)

# Reason for choosing Estonia graph
ggplot(top6, aes(x = reorder(Component, -Total_Proportion), 
                 y = Total_Proportion, fill = Total_Proportion)) +
  geom_bar(stat = "identity") + gg +
  xlab("What motivated you to come to this country?") + ylab("Count") +
  scale_fill_gradient(low = "lightblue", high = "darkblue") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Temporary protection is the predominant legal status covering around 50% of respondents. However, almost half of those who have taken the surey did not provide an answer, indicating possible administrative gaps or hesitation. The vast majority, over 92%, did not report having difficulties in accessing temporary protection, while only 3.24% faced obstacles. 

```{r}
# Function to create a clean proportion table
make_prop_table <- function(variable) {
  tibble(
    Category = names(table(variable, useNA = "ifany")),
    Count = as.numeric(table(variable, useNA = "ifany")),
    Percent = round(100 * (prop.table(table(variable, useNA = "ifany"))), 2)
  )
}

# Apply to each variable
#Legal Status proportions
legal_status_table <- make_prop_table(
  data_ee$documentation_legal_status)

#Difficulty in getting temp protection
legal_diff_table <- make_prop_table(
  data_ee$documentation_temp_protection_difficulty) 

# Types of difficulties 
legal_diff_what_table <- make_prop_table(
  data_ee$documentation_temp_protection_difficulty_what)

# View tables
legal_status_table
legal_diff_table
legal_diff_what_table

```
**Accommodation and Services**

Over two thirds of refugees did not report having issues with accommodation. High rent appeared to be the main concern with one fifth of respondents experiencing the issue. Other problems include insufficient privacy and poor hygiene infrastructure, such as showers and toilets, but these options were chosen by less than 6% of respondents each.

```{r}

# Function to create a clean proportion table


# Choose top-5 reasons for accommodation issues
top5 <- housing_issues_df |>
  dplyr::arrange(desc(Total_Proportion)) |>
  dplyr::slice_head(n = 5)
top5$Issue <- rownames(top5)

# Graph
ggplot(top5, aes(x = reorder(Issue, Total_Proportion), 
                 y = Total_Proportion, fill = Total_Proportion)) +
  geom_bar(stat = "identity") + gg +
  xlab("Proportion (%)") + ylab("Accommodation issues") +
  scale_fill_gradient(low = "lightblue", high = "darkblue")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

make_prop_table(data_ee$host_country_accomm_reason)



#Legal Status proportions
freq_table_legal_diff <- table(data_ee$host_country_SE2_11_SS_INC_SOR , useNA = "ifany")
prop_table_legal_diff <- prop.table(freq_table_legal_diff)
percent_table_legal_diff <- round(100 * prop_table_legal_diff, 2)
print(percent_table_legal_diff)

```

+ School
NA values were removed from columns related to childcare services, assuming that people who did not answer don't have children. Among those who participated in this section, almost everyone had access to childcare services. The situation was different with healthcare service. 30% of people experienced some problems with healthcare services, among which 49.5% reported long waiting times.

```{r}

# Remove NA values from childcare variable, assuming that NA respondents don't
# have children
data_ee_filtered <- data_ee |>
  filter(!is.na(host_country_childcare_services))

# Create the bar chart
ggplot(data_ee_filtered, aes(x = host_country_childcare_services, 
                             fill = host_country_childcare_services)) +
  geom_bar(stat = "count") +
  xlab("Childcare Services") +
  ylab("Count") +
  scale_fill_brewer(palette = "Paired") + gg

ggplot(data_ee_filtered, aes(x = host_country_healthcare_access, 
                             fill = host_country_healthcare_access)) +
  geom_bar(stat = "count") +
  xlab("Problems accessing Healthcare Services") +
  ylab("Count") +
  scale_fill_brewer(palette = "Paired") + gg

med_issues_df |>
  mutate(Percent = round(Total_Proportion * 100, 2)) |>
  select(Percent) |>
  arrange(desc(Percent))

```

**Economic capacity**

The main source of income for Ukrainian refugees is employment in host country, as reported by 50% of respondents. Around a third of people rely on social protection benefits provided by the host country. 10% of people reported having no income, other sources or social benefits from Ukrainian government. 31% of refugees didn't encounter any issues while looking for a job. The main concern, however, was the lack of language as 36% of people faced it. the second biggest obstacle was the lack of opportunities and lack of recognition, as noted by 11% and 7% of people respectively.

```{r}
income_sources_df |>
  mutate(Percent = round(Total_Proportion * 100, 2)) |>
  select(Percent) |>
  arrange(desc(Percent))

make_prop_table(data_ee$host_country_work_coa)

work_df |>
  mutate(Percent = Total_Proportion * 100) |>
  select(Percent) |>
  arrange(desc(Percent))
```

```{r}

make_prop_table(data_ee$economic_capicity_L13_SS_AFF_GOODS)
make_prop_table(data_ee$economic_capicity_L13_1_SM_MORE_GOODS)
make_prop_table(data_ee$economic_capicity_L13_1_SM_LESS_GOODS)
```


**Safety**
social_cohesion_SC3_SS_EXP_HOSTILE
social_cohesion_SC4_SM_HOSTILE_TYP

**Aid**
aap_AAP_0_SS_SATISFIED_AID
urgent_needs_urgent_needs_first
urgent_needs_urgent_needs_second
urgent_needs_urgent_needs_third
info_needs_info_receive 

**Traveling back**
Reasons of going permanently to Ukraine

Travel_Ukraine_temp_return 
Travel_Ukraine_temp_return_reason
Travel_Ukraine_no_return_plans 
Travel_Ukraine_no_return_move_country 
Travel_Ukraine_no_return_move_reasons 

**Discussion**

**Conclusion**